# Multimodal RAG (Text + Image Retrieval-Augmented Generation)

Мультимодальна RAG на основі статей з [The Batch](https://www.deeplearning.ai/the-batch/)

---

## Мета

Реалізувати пайплайн, який:

1. Завантажує статті та пов’язані з ними зображення.
2. Виконує препроцесинг тексту (сплітинг) та конвертацію зображень.
3. Створює ембеддинги для тексту та зображень за допомогою `OpenCLIP`.
4. Зберігає ці ембеддинги в ChromaDB для подальшого мультимодального пошуку.

---

## Складові

### 1. Завантаження статей і зображень

* Скрапінг статей з The Batch через `requests` + `BeautifulSoup` (було обрано статті з рубрик ML Research та Science)
* Витягування основного контенту та посилань на релевантні зображення.
* Фільтрація небажаних форматів (SVG, GIF, логотипів тощо).

### 2. Препроцесинг

* Збереження зображень локально, конвертація в `numpy` формат.
* Текст розбивається на шматки (`RecursiveCharacterTextSplitter`) для кращої індексації.

### 3. Ембеддинг

* `OpenCLIPEmbeddingFunction` використовується як єдиний embedding-функціонал для тексту та зображень.

### 4. Створення метаданих

* Для кожного елемента додаються метадані та id.

### 5. Збереження у векторну базу

* `ChromaDB` використовується як мультимодальна векторна база.

---

## Запуск

Для коректної роботи Streamlit-додатку потрібно виконати наступні кроки:

1. Встановити залежності (strongly рекомендовано робити через anaconda):


   ```bash
   conda env create -f environment.yml
   conda activate rag-env
   ```

    
    якщо нема anaconda тоді (Python==3.11.*)
    
    ```bash
    pip install -r requirements.txt
    ```
    
    > **Увага:** у випадку установки через pip може знадобитися додатково встановити Jupyter Notebook (VisualStudioCode автоматично пропонує встановлення компонентів при виборі середовища в .ipynb)
2. Додати (створити) `.env` файл з Google API ключем [GoogleAPI](https://aistudio.google.com/apikey):

   ```
   GOOGLE_API=your_api_key
   ```

3. Запустити кроки 1-5 блоків коду в rag.ipynb notebook

    ОБОВ'ЯЗКОВО!!!!!!

4. Запустити Streamlit-додаток:

   ```bash
   streamlit run app.py
   ```

---

## Технології

* `Streamlit` – інтерфейс користувача
* `BeautifulSoup`, `requests` – парсинг контенту
* `PIL`, `numpy` – обробка зображень
* `OpenCLIP`, `ChromaDB` – векторне представлення та індексація
* `LangChain` – завантаження та препроцесинг документів

## Оцінка

### Підхід

Для оцінки продуктивності мультимодальної RAG-системи було проведено ручне тестування з використанням типових запитів до бази статей з The Batch. Критеріями оцінки були:

* **Релевантність текстової відповіді** до запиту.
* **Змістовність відповіді** від LLM.

### Тестові приклади

| Запит користувача   | Результат                                                                                                                                              | Оцінка        |
|---------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|
| `AI and emissions`  | **Стаття:** *AI and Data Center Boom Challenges Big Tech’s Emissions Targets* | результат відповідає статті |
| `(зображення схеми AI Co-Scientist)`     | **Стаття:** *AI Co-Scientist: An Agent That Generates Research Hypotheses Aiding Drug Discovery* | результат достатньо релевантний статті |
| `energy cost of AI` | **Стаття:** *The International Energy Agency Examines the Energy Costs and Potential Savings of the AI Boom* | результат відповідає статті |

### Висновок

Результати показали, що коректно обробляються текстові запити та повертаються релевантні статті, які відповідають змісту запиту.  
Обробка зображень також працює, однак потребує подальшого доопрацювання для більш точного зіставлення з текстовим контентом (як і навпаки тексту із зображенням).  
У цілому демонструється працездатність мультимодального підходу, також має місце розширення для більш складних запитів і більших датасетів.
Наразі система завжди повертає найближчий результат. У покращенні варто додати фільтр на основі порогу схожості, щоб уникнути нерелевантних відповідей на позатематичні запити.